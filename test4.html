<!DOCTYPE html>
<head>
    <title>Loading data</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin=""></script>
</head>

<style>
    #map {
        height: 800px;
        width: 100%;
    }
</style>

<body>

<div id='map'></div>

<script>
    console.log("hello")
    const plan = 0;
    var routes = [];
    switch (plan){
        case 0:
            routes = [2];
            break;
        case 1:
            routes = [33, 35, 39, 41, 45, 47, 240];
            break;
        case 2:
            routes = [2, 6, 11, 33, 35, 39, 41, 45, 47, 200, 205, 209, 227, 232, 240, 248, 500, 509, 513, 516, 520];
            break;
        case 3:
            routes = [2,6,9,11,17,21,33,35,39,41,45,47,62,72,200,201,205,209,213,217,218,220,227,232,240,248,307,313,320,354,461,470,471,500,509,513,516,519,520,526,606,608,612,616,625,626,627,640,650,664,665,807,830,838,850,862,920];
            break;
    }
    var lineAbbrList = [];
    var lineNameList = [];
    var frequencyList = [];
    var latAList = [];
    var longAList = [];
    var latBList = [];
    var longBList = [];

    var map = L.map('map',{maxZoom:30,minZoom:10}).setView([40.7608,-111.8910], 12);
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoibHVmZXJvZHJpZ3VleiIsImEiOiJja3RjZ3NhcDUwNXczMnhwaWNsYWoza2g1In0.fKg-OIe61K3QHUHyNmtKaA'
            }).addTo(map);

    d3.json("/routes/test.json", function(data) {
        console.log(data);

        for (let i = 0 ; i < routes.length ; i++ ) {
            var q = 0;
            var posFinal = [0,0];
            var lineName ;
            for (let k = 0 ; k < data.length ; k++) {
                if (data[k].LineAbbr == routes[i]) {
                    eval( "var point_" + i + "_" + q + " = new L.LatLng(" + data[k].latA + "," + data[k].longA + ");" );
                    posFinal = [data[k].latB,data[k].longB]
                    lineName = data[k].LineName;
                    q++;
                }
            }
            eval( "var point_" + i + "_" + q + " = new L.LatLng(" + posFinal[0] + "," + posFinal[1] + ");" );
            var auxString = "var pointList_" + i +" = [" ;

            for (let p = 0 ; p < q ; p++){
                auxString = auxString +  "point_" + i + "_" + p + ",";
            }
            auxString = auxString + "point_" + i + "_" + q + "]";

            // add the charging station icon
            var chargingStationIcon = L.icon({
                iconUrl: 'icons/charging-station.png',
                iconSize: [26, 44],
                iconAnchor: [13, 44],
                popupAnchor: [0, -44]
            });

            eval( "var stationA_" + i + " = L.marker([point_" + i + "_0.lat" + ",point_" + i + "_0.lng], {icon: chargingStationIcon}).addTo(map).bindPopup(\"I am a charging station.\"); ");
            eval( "var stationB_" + i + " = L.marker([point_" + i + "_" + q + ".lat" + ",point_" + i + "_" + q + ".lng], {icon: chargingStationIcon}).addTo(map).bindPopup(\"I am a charging station.\"); ");

            // add the bus icon
            var busIcon = L.icon({
                iconUrl: 'icons/bus-icon.png',
                iconSize: [18.56, 20],
                iconAnchor: [9.28, 20],
                popupAnchor: [0, -20]
            });

            aux = Math.round( (0.1 + Math.random()*.8) * q)
            eval( "var busLoc_" + i + " = L.marker([point_" + i + "_" + aux + ".lat" + ",point_" + i + "_" + aux + ".lng], {icon: busIcon}).addTo(map).bindPopup(\"" + lineName + "<br>SOC: \"); ");

            eval( auxString );
            eval( "var polyline_" + i + " = new L.Polyline(pointList_" + i +", {color: 'red',weight: 5,opacity: 0.3,smoothFactor: 1}); " ) ;
            eval( "polyline_" + i + ".addTo(map);" );
            eval( "polyline_" + i + ".bindPopup(\"" + lineName +"\");" );

            eval( "polyline_" + i + ".on('mouseover', function(){ polyline_"+i+".setStyle({ color: \"red\", opacity: 0.8 }); });" );
            eval( "polyline_" + i + ".on('mouseout', function(){ polyline_"+i+".setStyle({ color: \"red\", opacity: 0.3 }); });" );
        }
        //polyline_0.on('mouseover', function(){ polyline_0.setStyle({ color: "red", opacity: 0.8 }); });
        //polyline_0.on('mouseout', function(){ polyline_0.setStyle({ color: "red", opacity: 0.3 });  });
    });

    // console.log(latAList)
    // alert(latAList.length)
    // alert(latAList[0])

    // var start_index = [];
    // var final_index = [];
    // var auxStart = 0;
    // var auxFinal = 0;
    // for (let i = 0 ; i<routes.length ; i++){
    //     var flag_start = false;
    //     for (let j = 0 ; j<latAList.length ; j++){
    //         if (lineAbbrList[j] == routes[i]){
    //             if (!flag_start){
    //                 auxStart = i;
    //                 flag_start = true;
    //             }
    //             auxFinal = i;
    //         }
    //     }
    //     start_index.push(auxStart);
    //     final_index.push(auxFinal);
    // }
    // console.log(auxStart);

</script>



</body>

<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <title>d3 Updating Bar Chart With Dropdown</title>
        <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
        <style>
        body {
            font: 10px sans-serif;
        }
        select {
            display: block;
        }
        .bar {
            fill: purple;
            opacity: 0.8;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        

/*the container must be positioned relative:*/
.custom-select {
  position: relative;
  font-family: Arial;
}

.custom-select select {
  display: none; /*hide original SELECT element:*/
}

.select-selected {
  background-color: DodgerBlue;
}

/*style the arrow inside the select element:*/
.select-selected:after {
  position: absolute;
  content: "";
  top: 14px;
  right: 10px;
  width: 0;
  height: 0;
  border: 6px solid transparent;
  border-color: #fff transparent transparent transparent;
}

/*point the arrow upwards when the select box is open (active):*/
.select-selected.select-arrow-active:after {
  border-color: transparent transparent #fff transparent;
  top: 7px;
}

/*style the items (options), including the selected item:*/
.select-items div,.select-selected {
  color: #ffffff;
  padding: 8px 16px;
  border: 1px solid transparent;
  border-color: transparent transparent rgba(0, 0, 0, 0.1) transparent;
  cursor: pointer;
  user-select: none;
}

/*style items (options):*/
.select-items {
  position: absolute;
  background-color: DodgerBlue;
  top: 100%;
  left: 0;
  right: 0;
  z-index: 99;
}

/*hide the items when the select box is closed:*/
.select-hide {
  display: none;
}

.select-items div:hover, .same-as-selected {
  background-color: rgba(0, 0, 0, 0.1);
}
</style>
    </head>
    <body>

<!-- Initialize a select button -->
<div class="custom-select" style="width:200px;">
<select id="plansbutton" ></select>
</div>

<select id="bebbutton" class="custom-select" style="width:200px;"></select>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>


<!--script>

  //Read the data
  d3.queue()
  .defer(d3.csv, "dataset/BEB_list_p20.csv")
  .defer(d3.csv, "dataset/BEB_list_p60.csv")
  .await(function(error, BEB_20, BEB_60) {
    BEB_20.forEach(function(d){ d['BEB'] = +d['BEB']; });
    BEB_60.forEach(function(d){ d['BEB'] = +d['BEB']; });
    console.log(BEB_20)
    console.log(BEB_60)
    if (error) throw error;

    // List of groups (here I have one group per column)
    var plans = ["Plan A", "Plan B", "Plan C"]

    // add the plan options to the button
    d3.select("#plansbutton")
          .selectAll('myOptions')
             .data(plans)
          .enter()
            .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }) // corresponding value returned by the button

    // Initialize the BEB list
    var BEB_list = d3.select("#bebbutton")
          .selectAll('myOptions')
             .data(BEB_20)
          .enter()
            .append('option')
          .text(function (d) { return d.BEB; }) // text showed in the menu
          .attr("value", function (d) { return d.BEB; }) // corresponding value returned by the button

    // A function that update the color of the circle
    function updatelists(plan, BEB_60) {
// Create new data with the selection?
      var dataFilter = data.map( function(d) { return BEB_60

        ;})
      BEB_list
      .selectAll('myOptions')
             .data(dataFilter)
          .enter()
            .append('option')
          .text(function (d) { return d.BEB; }) // text showed in the menu
          .attr("value", function (d) { return d.BEB; }) // corresponding value returned by the button
    }

    d3.select("#plansbutton").on("change", function(d){
    selectedGroup = this.value
    updatelists(selectedGroup, BEB_60)
  })




        
        
  });
  </script-->

<script>

  //Read the data
  d3.json("../dataset/BEB_list.json", function(data) {
        //data.forEach(function(d){ d['BEB'] = +d['BEB']; });
        //var BEB_p20 = {}
        console.log(data)


    // List of groups (here I have one group per column)

    var plans = d3.keys(data)
    var dat1 = data.Plan2
    console.log(dat1)

    // add the plan options to the button
    d3.select("#plansbutton")
          .selectAll('myOptions')
             .data(plans)
          .enter()
            .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }) // corresponding value returned by the button

    // Initialize the BEB list
    var BEB_list = d3.select("#bebbutton")
          .selectAll('myOptions')
             .data(data.Plan1)
          .enter()
            .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }); // corresponding value returned by the button

    // A function that update the color of the circle
    function updatelists(plan) {
// Create new data with the selection?
      //var dataFilter = data.map(function(d) { return d.plan; })
          d3.select("#bebbutton")
          .selectAll('myOptions')
             .data(data[plan])
             .enter()
            .append('option')
          .text(function (d) { return d; }) // text showed in the menu
          .attr("value", function (d) { return d; }) // corresponding value returned by the button
    };

    d3.select("#plansbutton").on("change", function(d){
    selectedGroup = this.value
    updatelists(selectedGroup)
  })




        
        
  });
  </script>


<!--script>

    // set the dimensions and margins of the graph
    var margin = {top: 10, right: 100, bottom: 30, left: 30},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    
    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    //Read the data
    d3.csv("../dataset/BEB_list_p20.csv", function(data) {
        data.forEach(function(d){ d['BEB'] = +d['BEB']; });
        var BEB_p20 = {}
        console.log(BEB_p20)
        
        // List of groups (here I have one group per column)
        var allGroup = ["valueA", "valueB", "valueC"]
    
        // add the options to the button
        d3.select("#selectButton")
          .selectAll('myOptions')
             .data(data)
          .enter()
            .append('option')
          .text(function (d) { return d.BEB; }) // text showed in the menu
          .attr("value", function (d) { return d.BEB; }) // corresponding value returned by the button
    
        // A color scale: one color for each group
        var myColor = d3.scaleOrdinal()
          .domain(allGroup)
          .range(d3.schemeSet2);
    
        // Add X axis > it is a date format
        var x = d3.scaleLinear()
          .domain([0,10])
          .range([ 0, width ]);
        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));
    
        // Add Y axis
        var y = d3.scaleLinear()
          .domain( [0,20])
          .range([ height, 0 ]);
        svg.append("g")
          .call(d3.axisLeft(y));
    
        // Initialize line with group a
        var line = svg
          .append('g')
          .append("path")
            .datum(data)
            .attr("d", d3.line()
              .x(function(d) { return x(+d.time) })
              .y(function(d) { return y(+d.valueA) })
            )
            .attr("stroke", function(d){ return myColor("valueA") })
            .style("stroke-width", 4)
            .style("fill", "none")
    
        // A function that update the chart
        function update(selectedGroup) {
    
          // Create new data with the selection?
          var dataFilter = data.map(function(d){return {time: d.time, value:d[selectedGroup]} })
    
          // Give these new data to update line
          line
              .datum(dataFilter)
              .transition()
              .duration(1000)
              .attr("d", d3.line()
                .x(function(d) { return x(+d.time) })
                .y(function(d) { return y(+d.value) })
              )
              .attr("stroke", function(d){ return myColor(selectedGroup) })
        }
    
        // When the button is changed, run the updateChart function
        d3.select("#selectButton").on("change", function(d) {
            // recover the option that has been chosen
            var selectedOption = d3.select(this).property("value")
            // run the updateChart function with this selected option
            update(selectedOption)
        })
    
    })
    
    
    </script-->




<!-- Color Scale>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>



        <div id='vis-container'></div>
        <script type="text/javascript">
            // Load and munge data, then make the visualization.
            var fileName = "./cereal-detailed.csv";
            var nutritionFields = ["calories", "protein", "fat", "sodium", "fiber",
                                   "carbs", "sugars", "potassium", "vitamins"];

            d3.csv(fileName, function(error, data) {
                var cerealMap = {};
                console.log(data);
                data.forEach(function(d) {
                    var cereal = d.cereal;
                    cerealMap[cereal] = [];

                    // { cerealName: [ bar1Val, bar2Val, ... ] }
                    nutritionFields.forEach(function(field) {
                        cerealMap[cereal].push( +d[field] );
                    });
                });
                makeVis(cerealMap);
            });

            var makeVis = function(cerealMap) {
                // Define dimensions of vis
                var margin = { top: 30, right: 50, bottom: 30, left: 50 },
                    width  = 550 - margin.left - margin.right,
                    height = 250 - margin.top  - margin.bottom;

                // Make x scale
                var xScale = d3.scale.ordinal()
                    .domain(nutritionFields)
                    .rangeRoundBands([0, width], 0.1);

                // Make y scale, the domain will be defined on bar update
                var yScale = d3.scale.linear()
                    .range([height, 0]);

                // Create canvas
                var canvas = d3.select("#vis-container")
                  .append("svg")
                    .attr("width",  width  + margin.left + margin.right)
                    .attr("height", height + margin.top  + margin.bottom)
                  .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                // Make x-axis and add to canvas
                var xAxis = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom");

                canvas.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

                // Make y-axis and add to canvas
                var yAxis = d3.svg.axis()
                    .scale(yScale)
                    .orient("left");

                var yAxisHandleForUpdate = canvas.append("g")
                    .attr("class", "y axis")
                    .call(yAxis);

                yAxisHandleForUpdate.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Value");

                var updateBars = function(data) {
                    // First update the y-axis domain to match data
                    yScale.domain( d3.extent(data) );
                    yAxisHandleForUpdate.call(yAxis);

                    var bars = canvas.selectAll(".bar").data(data);

                    // Add bars for new data
                    bars.enter()
                      .append("rect")
                        .attr("class", "bar")
                        .attr("x", function(d,i) { return xScale( nutritionFields[i] ); })
                        .attr("width", xScale.rangeBand())
                        .attr("y", function(d,i) { return yScale(d); })
                        .attr("height", function(d,i) { return height - yScale(d); });

                    // Update old ones, already have x / width from before
                    bars
                        .transition().duration(250)
                        .attr("y", function(d,i) { return yScale(d); })
                        .attr("height", function(d,i) { return height - yScale(d); });

                    // Remove old ones
                    bars.exit().remove();
                };

                // Handler for dropdown value change
                var dropdownChange = function() {
                    var newCereal = d3.select(this).property('value'),
                        newData   = cerealMap[newCereal];

                    updateBars(newData);
                };

                // Get names of cereals, for dropdown
                var cereals = Object.keys(cerealMap).sort();

                var dropdown = d3.select("#vis-container")
                    .insert("select", "svg")
                    .on("change", dropdownChange);

                dropdown.selectAll("option")
                    .data(cereals)
                  .enter().append("option")
                    .attr("value", function (d) { return d; })
                    .text(function (d) {
                        return d[0].toUpperCase() + d.slice(1,d.length); // capitalize 1st letter
                    });

                var initialData = cerealMap[ cereals[0] ];
                updateBars(initialData);
            };
        </script-->
    </body>
</html>