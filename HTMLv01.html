<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v4.min.js"></script>

<link rel="stylesheet" href=
"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity=
"sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
		crossorigin="anonymous">

	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity=
"sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
		crossorigin="anonymous">
	</script>
	
	<script src=
"https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity=
"sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous">
	</script>
	
	<script src=
"https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity=
"sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		crossorigin="anonymous">
	</script>



<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
	crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
	crossorigin=""></script>

<script>
	(function(document) {
		'use strict';

		var TableFilter = (function(myArray) {
			var search_input;

			function _onInputSearch(e) {
				search_input = e.target;
				var tables = document.getElementsByClassName(search_input.getAttribute('data-table'));
				myArray.forEach.call(tables, function(table) {
					myArray.forEach.call(table.tBodies, function(tbody) {
						myArray.forEach.call(tbody.rows, function(row) {
							var text_content = row.textContent.toLowerCase();
							var search_val = search_input.value.toLowerCase();
							row.style.display = text_content.indexOf(search_val) > -1 ? '' : 'none';
						});
					});
				});
			}

			return {
				init: function() {
					var inputs = document.getElementsByClassName('search-input');
					myArray.forEach.call(inputs, function(input) {
						input.oninput = _onInputSearch;
					});
				}
			};
		})(Array.prototype);

		document.addEventListener('readystatechange', function() {
			if (document.readyState === 'complete') {
				TableFilter.init();
			}
		});

	})(document);
</script>
<style type="text/css">
body {
	margin:10px;
	font-family:"Arial Rounded MT Bold", Arial, Helvetica, sans-serif
}
h3 span {
	font-size: 22px;
}
h3 input.search-input {
	width: 20px;
	margin-left: auto;
	float: right
}


.wrapper {
	height: 500px;
    width: 100%;
	display: flex;
	background-size: cover;
	padding:20px;
	position: relative;
	z-index: 9999999999;
}

.box1 {
	width:211px;
	height:244px;
	margin:5px;
	padding:5px;
	background-color: rgba(191, 191, 191, 0);
	position: absolute;
	right: 0px;
	top: 100px;
}

.box3 {
	width:332px;
	height:181px;
	margin:5px;
	padding:5px;
	background-color: rgba(138, 28, 28, 0);
	position: absolute;
	z-index: 9999999999;
	top: 100px;
	left: 10px;
}

.box3b {
	width:332px;
	height:342px;
	margin:5px;
	padding:5px;
	background-color: rgba(138, 28, 28, 0);
	position: absolute;
	z-index: 9999999999;
	left: 10px;
	bottom: 120px;
}

.boxRoute {
	width:340px;
	height:180px;
	background: #c00;
	padding:5px 10px 5px 10px;
	border-radius: 0px 25px 25px 0px;
    background-color: rgba(191, 191, 191, 0.8);
    color: rgb(0, 0, 0);
}
.boxBEB {
	width:320px;
	height:350px;
	background: #c00;
	padding:5px 10px 5px 10px;
	border-radius: 0px 25px 25px 0px;
    background-color: rgba(191, 191, 191, 0.8);
    color: rgb(0, 0, 0);
}

.boxCS {
	width:320px;
	float:right;
	height:270px;
	background: #c00;
	padding:10px 5px 10px 5px;
	border-radius: 25px 0px 0px 25px;
    background-color: rgba(191, 191, 191, 0.8);
    color: rgb(0, 0, 0);
}

.tableFixHead {
        overflow-y: auto;
        height: 128px;
      }
      .tableFixHead thead th {
        position: sticky;
        top: 0;
      }
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        padding: 0.25rem;
        border: 1px solid rgb(0, 0, 0);
		text-align:center;
      }
	  th {
        background: rgb(77, 77, 77);
		color: #fff;
      }

.header {
  overflow: hidden;
  background-color: rgba(191, 191, 191, 0);
  padding: 5px 5px;
  z-index: 9999;
  position: relative;
}
.header a {
  float: left;
  color: black;
  text-align: center;
  padding: 5px;
  text-decoration: none;
  font-size: 16px; 
  line-height: 20px;
  border-radius: 5px;
}
.header a.logo {
  font-size: 20px;
  font-weight: bold;
}

.header a:hover {
  background-color: #ddd;
  color: black;
}

.header a.active {
  background-color: dodgerblue;
  color: white;
}

.header-right {
  float: right;
  padding: 0px 10px;
}

div.right {float: right;}



@media screen and (max-width: 500px) {
  .header a {
    float: none;
    display: block;
    text-align: left;
  }
  
  .header-right {
    float: right !important;
  }
}
p.ex1 {
  font-size: 15px;	
  margin: 0px;	
  padding: 10px;
}
.slidecontainer {
  width: 100%;
  padding: 5px;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 10px;
  border-radius: 5px;
  background: #808080;
  outline: none;
  opacity: 0.7;
  -webkit-transition: .2s;
  transition: opacity .2s;
}

.slider:hover {
  opacity: 1;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #0423aa;
  cursor: pointer;
}

.slider::-moz-range-thumb {
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background: #04AA6D;
  cursor: pointer;
}


a.a1.dropdown-item {	color: rgb(255, 248, 248) ;
	border-style: solid;
	border-radius: 5px;}


hr {
  margin-top: 1rem;
  margin-bottom: 1rem;
  border: 0;
  border-top: 1px solid #444444;
}

div.round {
  border: 1px solid;
  border-radius: 8px;
  padding: 5px;
}

p.round {
  border: 1px solid;
  border-radius: 8px;
  padding: 5px;
}

.dropbtn1 {
  background-color: #4CAF50;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

div.dropdown-menu {
    background-color: #00000098;
	color: rgb(255, 248, 248) ;
	min-width: 5rem;
	position: relative;
	z-index: 999999999999;
}

#battery-status {
	background-color: none;
	height: 30px;
	width: 100%;
	position: relative;
}

#chart1 {
	background-color: none;
	height: 120px;
	width: 100%;
	position: relative;
}

#chart2 {
	background-color: none;
	height: 120px;
	width: 100%;
	position: relative;
}

#chart3 {
	background-color: none;
	height: 120px;
	width: 100%;
	position: relative;
}

.label {
	font-family: 'Courier New', Courier, monospace;
	font-size: 8pt;
}

.battery-icon{
	width: 35px;
	height: 23px;
}

</style>
<title>Rounded Corner Boxes</title>
</head>
<body>
	<div>
		<ul class="nav nav-pills">
			<li class="nav-item dropdown">
				<a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Plans</a>
				<div class="dropdown-menu">
					<a href="#" class="a1 dropdown-item">Plan A</a>
					<div class="dropdown-divider"></div>
					<a href="#" class="a1 dropdown-item">Plan B</a>
					<div class="dropdown-divider"></div>
					<a href="#" class="a1 dropdown-item">Plan C</a>
				</div>
			</li>
			<div>
				<select id="plansbutton" class="custom-select" style="width:80px;"></select>
			</div>

			<div class=" round col-6 slidecontainer" style="height:32px">
				<input type="range" min="0" max="24" value="0" step="0.5" class="slider" id="myRange">
			</div>
			<div>
				<p class="round col-sm-12" style= padding:4px>Time: <span id="demo"></span></p>
			</div>

			<li class="nav-item ms-auto">
				<a href="#" class="nav-link">Static Data</a>
			</li>
			<li class="nav-item ms-auto">
				<a href="#" class="nav-link">About</a>
			</li>
		</ul>
	</div>


<div id="wrap2" style="width:100%; height:95% ;">

	<div id='map' style="width:100%; height:95% ;position: fixed;"></div>
	
	<div class="box3">
		<div class="boxRoute">
			<div class="row">
				<div class="col-sm-6"><p class="ex1"><b>BEB Route Info</b></p></div>
				<div class="col-sm-6"><input type="search" placeholder="Search..." class="form-control search-input" data-table="customers-list" font-size:50%/></div>
			</div>
			
			<div class="tableFixHead">
				<table id="beb_table" style = font-size:80% class = "sortable table-striped customers-list"> 
					<!-- <thead> 
					<tr> 
						<th>BEB #</th> 
						<th>SOC %</th> 
						<th>Mileage</th> 
						<th>Route</th> 
						<th>Location</th> 
					</tr> 
					</thead>  -->
					<!--tbody> 
					<tr> 
						<td>1001</td> 
						<td>50</td> 
						<td>10</td> 
						<td>46</td> 
						<td>xxx</td> 
					</tr> 
					<tr> 
						<td>1002</td> 
						<td>40</td> 
						<td>10</td> 
						<td>45</td> 
						<td>xx</td> 
					</tr> 
					<tr> 
						<td>1003</td> 
						<td>30</td> 
						<td>10</td> 
						<td>45</td> 
						<td>xx</td> 
					</tr> 
					<tr> 
						<td>1004</td> 
						<td>20</td> 
						<td>10</td> 
						<td>45</td> 
						<td>xx</td> 
					</tr> 
					<tr> 
						<td>1005</td> 
						<td>60</td> 
						<td>10</td> 
						<td>45</td> 
						<td>xx</td> 
					</tr>
					<tr> 
						<td>1001</td> 
						<td>50</td> 
						<td>10</td> 
						<td>45</td> 
						<td>xx</td> 
					</tr>
					</tbody--> 
					</table> 
			</div>
		</div>
	
	</div>
		
	<div class="box3b">
		<div class="boxBEB">
			<div class="row">
				<div class="col-sm-6"><p class="ex1"><b>BEB Info</b></p></div>
				<div class="col-sm-6" style="left: 30px;">
					<select id="bebbutton" class="custom-select" style="width:100px;"></select>
				</div>
				<!-- <div class="dropdown">
					<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					BEB #
					</button>
					<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
						<a class="a1 dropdown-item" href="#">1011</a>
						<a class="a1 dropdown-item" href="#">1012</a>
						<a class="a1 dropdown-item" href="#">1013</a>
					</div>
				</div> -->
			</div>
			<div id="battery-status">
				<div style="width: 150px; float:left; height:20px; background:none; margin:0px">Battery status:</div>
				<div style="width: 150px; float:left; height:20px; background:none; margin:0px; text-align:right"> <img src="icons/battery-full.png" id="battery-icon" class="battery-icon"> </div>
			</div>
			<div id="chart1"></div>
			<div id="chart2"></div>
		</div>
	</div>

	<div class="box1">
		<div class="boxCS">
			<div class="row">
				<div class="col-sm-4"><p class="ex1"><b>Charging Station</b></p></div>
				<div class="col-sm-6" style="top: 13px;">
					<select id="cebutton" class="custom-select" style="width:200px;"></select>
				</div>
			</div>
			<div id="battery-status">
			<div style="width: 150px; float:left; height:20px; background:none; margin:0px">Station status:</div>
			<div style="width: 150px; float:left; height:20px; background:none; margin:0px; text-align: right;"><img src="icons/free.png" id="charging-icon"></div>
		</div>
		<div id="chart3"></div>
		</div>
	</div>

</div>

<script>
    const plan = 3;
    var routes = [];
    switch (plan){
        case 0:
            routes = [2];
            break;
        case 1:
            routes = [33, 35, 39, 41, 45, 47, 240];
            break;
        case 2:
            routes = [2, 6, 11, 33, 35, 39, 41, 45, 47, 200, 205, 209, 227, 232, 240, 248, 500, 509, 513, 516, 520];
            break;
        case 3:
            routes = [2,6,9,11,17,21,33,35,39,41,45,47,62,72,200,201,205,209,213,217,218,220,227,232,240,248,307,313,320,354,461,470,471,500,509,513,516,519,520,526,606,608,612,616,625,626,627,640,650,664,665,807,830,838,850,862,920];
            break;
    }

    var map = L.map('map',{maxZoom:30,minZoom:10}).setView([40.7608,-111.8910], 12);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoibHVmZXJvZHJpZ3VleiIsImEiOiJja3RjZ3NhcDUwNXczMnhwaWNsYWoza2g1In0.fKg-OIe61K3QHUHyNmtKaA'
            }).addTo(map);




	d3.queue()
		.defer(d3.json, "/routes/NewRoutes_def.json")
		.defer(d3.json, "/dataset/charging_stations.json")
		.await(function(error, data, ce_data) {
		if (error) throw error;

		// add the charging station icon
		var chargingStationIcon = L.icon({
			iconUrl: 'icons/charging-station.png',
			iconSize: [26, 44],
			iconAnchor: [13, 44],
			popupAnchor: [0, -44]
		});

		// add the bus icon
		var busIcon = L.icon({
			iconUrl: 'icons/bus-icon.png',
			iconSize: [18.56, 20],
			iconAnchor: [9.28, 20],
			popupAnchor: [0, -20]
		});

        for (let i = 0 ; i < routes.length ; i++ ) {
            var q = 0;
            var posFinal = [0,0];
            var lineName ;
            for (let k = 0 ; k < data.length ; k++) {
                if (data[k].LineAbbr == routes[i]) {
                    eval( "var point_" + i + "_" + q + " = new L.LatLng(" + data[k].latA + "," + data[k].longA + ");" );
                    posFinal = [data[k].latB,data[k].longB]
                    lineName = data[k].LineName;
                    q++;
                }
            }
            eval( "var point_" + i + "_" + q + " = new L.LatLng(" + posFinal[0] + "," + posFinal[1] + ");" );
            var auxString = "var pointList_" + i +" = [" ;

            for (let p = 0 ; p < q ; p++){
                auxString = auxString +  "point_" + i + "_" + p + ",";
            }
            auxString = auxString + "point_" + i + "_" + q + "]";

            aux = Math.round( (0.1 + Math.random()*.8) * q)
            eval( "var busLoc_" + i + " = L.marker([point_" + i + "_" + aux + ".lat" + ",point_" + i + "_" + aux + ".lng], {icon: busIcon}).addTo(map).bindPopup(\"" + lineName + "<br>SOC: \"); ");

            eval( auxString );
            eval( "var polyline_" + i + " = new L.Polyline(pointList_" + i +", {color: 'red',weight: 5,opacity: 0.6,smoothFactor: 1}); " ) ;
            eval( "polyline_" + i + ".addTo(map);" );
            eval( "polyline_" + i + ".bindPopup(\"" + lineName +"\");" );

			eval( "polyline_" + i + ".on('click', function(){ polyline_"+i+".setStyle({ color: \"red\", opacity: 1, weight: 10 }); });" );
			eval( "polyline_" + i + ".on('popupclose', function(e){ e.target.setStyle({color: \"red\", opacity: 0.6, weight: 5}); });" );
        }
		// locate the charging stations
		for (let k = 0; k < eval("ce_data.Plan" + plan + ".Name.length") ; k++){
			alert("var station_" + k + " = L.marker([ce_data.Plan"+ plan +".Latitude["+ k + "], ce_data.Plan" + plan +".Longitude[" + k + "]], {icon: chargingStationIcon}).addTo(map).bindPopup(ce_data.Plan" + plan + ".Name[" + k + "]); ")
			eval( "var station_" + k + " = L.marker([ce_data.Plan"+ plan +".Latitude["+ k + "], ce_data.Plan" + plan +".Longitude[" + k + "]], {icon: chargingStationIcon}).addTo(map).bindPopup(ce_data.Plan" + plan + ".Name[" + k + "]); ");
		}
		
    });
</script>


<script>
	var divWidth = document.getElementById("chart1").clientWidth;
	// set the dimensions and margins of the graph
	var margin = {top: 10, right: 10, bottom: 30, left: 40},
		width = divWidth - margin.left - margin.right,
		height = 110 - margin.top - margin.bottom;

	// append the svg object to the body of the page
	var svg1 = d3.select("#chart1")
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	.append("g")
		.attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	var svg2 = d3.select("#chart2")
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	.append("g")
		.attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	var svg3 = d3.select("#chart3")
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	.append("g")
		.attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	//Read the data
	d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/3_TwoNumOrdered_comma.csv",

	// When reading the csv, I must format variables:
	function(d){
		return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.value }
	},

	// Now I can use this dataset:
	function(data) {

		// Add X axis --> it is a date format
		var x = d3.scaleTime()
			.domain(d3.extent(data, function(d) { return d.date; }))
			.range([ 0, width ]);
		let xaxis = d3.axisBottom(x);
		svg1.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(xaxis);

		// Add Y axis
		var y1 = d3.scaleLinear()
			.domain([0, 400])
			.range([ height, 0 ]);
		let yaxis = d3.axisLeft(y1);
		yaxis.ticks(5);
		svg1.append("g")
			.call(yaxis);

		// Add the line
		svg1.append("path")
			.datum(data)
			.attr("fill", "none")
			.attr("stroke", "steelblue")
			.attr("stroke-width", 1.5)
			.attr("d", d3.line()
				.x(function(d) { return x(d.date) })
				.y(function(d) { return y1(d.value) })
				);
		
		svg1.append("text")
			.attr("class", "x label")
			.attr("text-anchor", "end")
			.attr("x", width/2)
			.attr("y", height+30)
			.text("Time");

		svg1.append("text")
			.attr("class", "y label")
			.attr("text-anchor", "end")
			.attr("x", -height/2+10)
			.attr("y", -30)
			//.attr("dy", ".75em")
			.attr("transform", "rotate(-90)")
			.text("SOC");


		//let xaxis = d3.axisBottom(x);
		svg2.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(xaxis);
		// Add Y axis
		var y2 = d3.scaleLinear()
			.domain([0, 50])
			.range([ height, 0 ]);
		let y2axis = d3.axisLeft(y2);
		y2axis.ticks(5);
		svg2.append("g")
			.call(y2axis);

		// Add the line
		svg2.append("path")
			.datum(data)
			.attr("fill", "none")
			.attr("stroke", "steelblue")
			.attr("stroke-width", 1.5)
			.attr("d", d3.line()
				.x(function(d) { return x(d.date) })
				.y(function(d) { return y2(d.value/100) })
				);
		
		svg2.append("text")
			.attr("class", "x label")
			.attr("text-anchor", "end")
			.attr("x", width/2)
			.attr("y", height+30)
			.text("Time");

		svg2.append("text")
			.attr("class", "y label")
			.attr("text-anchor", "end")
			.attr("x", -height/2+20)
			.attr("y", -30)
			.attr("transform", "rotate(-90)")
			.text("Mileage");


		svg3.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(xaxis);
		// Add Y axis
		var y3 = d3.scaleLinear()
			.domain([0, 400])
			.range([ height, 0 ]);
		let y3axis = d3.axisLeft(y3);
		y3axis.ticks(5);
		svg3.append("g")
			.call(y3axis);

		// Add the line
		svg3.append("path")
			.datum(data)
			.attr("fill", "none")
			.attr("stroke", "steelblue")
			.attr("stroke-width", 1.5)
			.attr("d", d3.line()
				.x(function(d) { return x(d.date) })
				.y(function(d) { return y3(d.value) })
				);
		
		svg3.append("text")
			.attr("class", "x label")
			.attr("text-anchor", "end")
			.attr("x", width/2)
			.attr("y", height+30)
			.text("Time");

		svg3.append("text")
			.attr("class", "y label")
			.attr("text-anchor", "end")
			.attr("x", -height/2+40)
			.attr("y", -30)
			.attr("transform", "rotate(-90)")
			.text("Energy cons.");
	})

	d3.select("#bebbutton").on("change", function(d){
		selectedBEB = this.value
		var x = Math.random();
		if (x<0.33){
			document.getElementById("battery-icon").src = "icons/battery-red.png";
		}
		else{
			if (x>=0.33 && x<0.67){
				document.getElementById("battery-icon").src = "icons/battery-yellow.png";
			}
			else{
				document.getElementById("battery-icon").src = "icons/battery-green.png";
			}
		}
	}) 
	
	d3.select("#cebutton").on("change", function(d){
		selectedCE = this.value
		var x = Math.random();
		if (x<0.2){
			document.getElementById("charging-icon").src = "icons/in-use.png";
		}
		else{
			document.getElementById("charging-icon").src = "icons/free.png";	
		}
	}) 
</script>




	<script>
		d3.queue()
		    .defer(d3.json, "../dataset/BEB_list.json")
			.defer(d3.csv, "../dataset/BEB_table_p20.csv")
			.defer(d3.csv, "../dataset/BEB_table_p60.csv")
			.defer(d3.csv, "../dataset/BEB_table_p180.csv")
			.defer(d3.json, "../dataset/CE_list.json")
			.await(function(error, data, data1, data2, data3, ce_data) {
			if (error) throw error;

			const plans = d3.keys(data)

			// add the plan options to the button
			d3.select("#plansbutton")
			.selectAll('myOptions')
			   .data(plans)
			.enter()
			  .append('option')
			.text(function (d) { return d; }) // text showed in the menu
			.attr("value", function (d) { return d; }) // corresponding value returned by the button

			// Initialize the BEB list
			var BEB_list = d3.select("#bebbutton")
			.selectAll('myOptions')
			   .data(data.Plan1)
			.enter()
			  .append('option')
			.text(function (d) { return d; }) // text showed in the menu
			.attr("value", function (d) { return d; }); // corresponding value returned by the button

			// Initialize the CE list
			var CE_list = d3.select("#cebutton")
			.selectAll('myOptions')
			   .data(ce_data.Plan1)
			.enter()
			  .append('option')
			.text(function (d) { return d; }) // text showed in the menu
			.attr("value", function (d) { return d; }); // corresponding value returned by the button

					
			// A function that update the list of the beb
			function updatelists(plan) {
			var bobs = d3.select("#bebbutton")
			.selectAll('myOptions')
			   .data(data[plan])
			   .enter()
			  .append('option')
			.text(function (d) { return d; }) // text showed in the menu
			.attr("value", function (d) { return d; }) // corresponding value returned by the button
	  		};

			  // A function that update the list of the beb
			function updatece(plan) {
			var bobs = d3.select("#cebutton")
			.selectAll('myOptions')
			   .data(ce_data[plan])
			   .enter()
			  .append('option')
			.text(function (d) { return d; }) // text showed in the menu
			.attr("value", function (d) { return d; }) // corresponding value returned by the button
	  		};

		function tabulate(data, columns) {
			var table = d3.select('#beb_table')
			var thead = table.append('thead')
			var	tbody = table.append('tbody');
			const m_column = ['BEB #', 'SoC %', 'Mileage', 'Route', 'Status']

			// append the header row
			thead.append('tr')
			.selectAll('th')
			.data(columns).enter()
			.append('th')
				.text(function (column) { return column; });

			// create a row for each object in the data
			var rows = tbody.selectAll('tr')
			.data(data)
			.enter()
			.append('tr');

			// create a cell in each row for each column
			var cells = rows.selectAll('td')
			.data(function (row) {
				return columns.map(function (column) {
				return {column: column, value: row[column]};
				});
			})
			.enter()
			.append('td')
				.text(function (d) { return d.value; });

		return table;
		}

		// Initialize the table
		tabulate(data1, ['BEB', 'SoC', 'Mileage', 'Route', 'Location']); // 2 column table


		function updatetable(plan) {
			if (plan == "Plan1"){
				tabulate(data1, ['BEB', 'SoC', 'Mileage', 'Route', 'Location']);
			}
			if (plan == "Plan2"){
				tabulate(data2, ['BEB', 'SoC', 'Mileage', 'Route', 'Location']);
			}
			if (plan == "Plan3"){
				tabulate(data3, ['BEB', 'SoC', 'Mileage', 'Route', 'Location']);
			}
		}


		function delete_table() {
			//clears all the guardians with the specified id
			document.getElementById("beb_table").innerHTML =
				null;
		}

		function delete_beb() {
				//clears all the guardians with the specified id
				document.getElementById("bebbutton").innerHTML =
					null;
			}

		function delete_ce() {
				//clears all the guardians with the specified id
				document.getElementById("cebutton").innerHTML =
					null;
			}

		function delete_map() {
			if (map != undefined) {
				map.remove(); 
			}
		}

		function updatemap(plan){
			// insert the map
			var routes = [];
			switch (plan){
				case 'Plan1':
					routes = [33, 35, 39, 41, 45, 47, 240];
					break;
				case 'Plan2':
					routes = [2, 6, 11, 33, 35, 39, 41, 45, 47, 200, 205, 209, 227, 232, 240, 248, 500, 509, 513, 516, 520];
					break;
				case 'Plan3':
					routes = [2,6,9,11,17,21,33,35,39,41,45,47,62,72,200,201,205,209,213,217,218,220,227,232,240,248,307,313,320,354,461,470,471,500,509,513,516,519,520,526,606,608,612,616,625,626,627,640,650,664,665,807,830,838,850,862,920];
					break;
				default:
					routes = [2];
					break;
			}

			map = L.map('map',{maxZoom:30,minZoom:10}).setView([40.7608,-111.8910], 12);
			L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
				maxZoom: 18,
				id: 'mapbox/streets-v11',
				tileSize: 512,
				zoomOffset: -1,
				accessToken: 'pk.eyJ1IjoibHVmZXJvZHJpZ3VleiIsImEiOiJja3RjZ3NhcDUwNXczMnhwaWNsYWoza2g1In0.fKg-OIe61K3QHUHyNmtKaA'
				}).addTo(map);
			

				d3.queue()
					.defer(d3.json, "/routes/NewRoutes_def.json")
					.defer(d3.json, "/dataset/charging_stations.json")
					.await(function(error, data, ce_data) {
					if (error) throw error;

					// add the charging station icon
					var chargingStationIcon = L.icon({
						iconUrl: 'icons/charging-station.png',
						iconSize: [26, 44],
						iconAnchor: [13, 44],
						popupAnchor: [0, -44]
					});

					// add the bus icon
					var busIcon = L.icon({
						iconUrl: 'icons/bus-icon.png',
						iconSize: [18.56, 20],
						iconAnchor: [9.28, 20],
						popupAnchor: [0, -20]
					});

					for (let i = 0 ; i < routes.length ; i++ ) {
						var q = 0;
						var posFinal = [0,0];
						var lineName ;
						for (let k = 0 ; k < data.length ; k++) {
							if (data[k].LineAbbr == routes[i]) {
								eval( "var point_" + i + "_" + q + " = new L.LatLng(" + data[k].latA + "," + data[k].longA + ");" );
								posFinal = [data[k].latB,data[k].longB]
								lineName = data[k].LineName;
								q++;
							}
						}
						eval( "var point_" + i + "_" + q + " = new L.LatLng(" + posFinal[0] + "," + posFinal[1] + ");" );
						var auxString = "var pointList_" + i +" = [" ;

						for (let p = 0 ; p < q ; p++){
							auxString = auxString +  "point_" + i + "_" + p + ",";
						}
						auxString = auxString + "point_" + i + "_" + q + "]";

						aux = Math.round( (0.1 + Math.random()*.8) * q)
						eval( "var busLoc_" + i + " = L.marker([point_" + i + "_" + aux + ".lat" + ",point_" + i + "_" + aux + ".lng], {icon: busIcon}).addTo(map).bindPopup(\"" + lineName + "<br>SOC: \"); ");

						eval( auxString );
						eval( "var polyline_" + i + " = new L.Polyline(pointList_" + i +", {color: 'red',weight: 5,opacity: 0.6,smoothFactor: 1}); " ) ;
						eval( "polyline_" + i + ".addTo(map);" );
						eval( "polyline_" + i + ".bindPopup(\"" + lineName +"\");" );

						eval( "polyline_" + i + ".on('click', function(){ polyline_"+i+".setStyle({ color: \"red\", opacity: 1, weight: 10 }); });" );
						eval( "polyline_" + i + ".on('popupclose', function(e){ e.target.setStyle({color: \"red\", opacity: 0.6, weight: 5}); });" );
					}
					// locate the charging stations
					alert(eval("ce_data.Plan" + plan + ".Name.length"))
					for (let k = 0; k < eval("ce_data.Plan" + plan + ".Name.length") ; k++){
						alert("var station_" + k + " = L.marker([ce_data.Plan"+ plan +".Latitude["+ k + "], ce_data.Plan" + plan +".Longitude[" + k + "]], {icon: chargingStationIcon}).addTo(map).bindPopup(ce_data.Plan" + plan + ".Name[" + k + "]); ")
						eval( "var station_" + k + " = L.marker([ce_data.Plan"+ plan +".Latitude["+ k + "], ce_data.Plan" + plan +".Longitude[" + k + "]], {icon: chargingStationIcon}).addTo(map).bindPopup(ce_data.Plan" + plan + ".Name[" + k + "]); ");
					}
				
				});
	}

	d3.select("#plansbutton").on("change", function(d){
		selectedGroup = this.value
		delete_beb()
		delete_ce()
		delete_table()
		delete_map()
		updatelists(selectedGroup)
		updatece(selectedGroup)
		updatetable(selectedGroup)
		updatemap(selectedGroup)
	})    
		  
	});

</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>

	

</body>
</html>
	