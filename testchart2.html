<html>
    <head>
        <title>Test charts</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
<body>

<div id="chart1"></div>


<script>
	var divWidth = document.getElementById("chart1").clientWidth;
	// set the dimensions and margins of the graph
	var margin = {top: 10, right: 10, bottom: 30, left: 40},
		width = divWidth - margin.left - margin.right,
		height = 200 - margin.top - margin.bottom;

	// append the svg object to the body of the page
	var svg1 = d3.select("#chart1")
	.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
	.append("g")
		.attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	//Read the data
	d3.json("/dataset/final_data.json",

	// When reading the csv, I must format variables:

	// Now I can use this dataset:
	function(data) {

        var planList = Object.keys( data );
        var busNumbers = Object.keys( data["Plan1"] );
        var times = Object.keys(data["Plan1"][busNumbers[0]]);
        var SoC = [];
        var mileage = [];

        auxData1 = "dataSoC = [";
        auxData2 = "dataMileage = [";
        for (let i=0 ; i<times.length ; i++){
            SoC.push( data[planList[0]][busNumbers[0]][times[i]]["SoC"] );
            mileage.push( data[planList[0]][busNumbers[0]][times[i]]["Mileage"] );

            auxData1 = auxData1 + "{ x: " + times[i] + ",   y: " + SoC[i] + " },\n";
            auxData2 = auxData2 + "{ x: " + times[i] + ",   y: " + mileage[i] + " },\n";
        }
        auxData1 = auxData1 + "];";
        auxData2 = auxData2 + "];";
        eval(auxData1);
        eval(auxData2);
        

		// Add X axis --> it is a date format
		var x = d3.scaleLinear()
			.domain([0,24])
			.range([ 0, width ]);
		let xaxis = d3.axisBottom(x);
		svg1.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(xaxis);

		// Add Y axis
		var y1 = d3.scaleLinear()
			.domain([0, 100])
			.range([ height, 0 ]);
		let yaxis = d3.axisLeft(y1);
		yaxis.ticks(5);
		svg1.append("g")
			.call(yaxis);

		// Add the line
		svg1.append("path")
			.datum(dataSoC)
			.attr("fill", "none")
			.attr("stroke", "steelblue")
			.attr("stroke-width", 1.5)
			.attr("d", d3.line()
				.x(d => x(d.x) )
				.y(d => y1(d.y) )
				);
		
		svg1.append("text")
			.attr("class", "x label")
			.attr("text-anchor", "end")
			.attr("x", width/2)
			.attr("y", height+30)
			.text("Time");

		svg1.append("text")
			.attr("class", "y label")
			.attr("text-anchor", "end")
			.attr("x", -height/2+10)
			.attr("y", -30)
			//.attr("dy", ".75em")
			.attr("transform", "rotate(-90)")
			.text("SOC");
	// })

	// d3.select("#bebbutton").on("change", function(d){
	// 	selectedBEB = this.value
	// 	var x = Math.random();
	// 	if (x<0.33){
	// 		document.getElementById("battery-icon").src = "icons/battery-red.png";
	// 	}
	// 	else{
	// 		if (x>=0.33 && x<0.67){
	// 			document.getElementById("battery-icon").src = "icons/battery-yellow.png";
	// 		}
	// 		else{
	// 			document.getElementById("battery-icon").src = "icons/battery-green.png";
	// 		}
	// 	}
	// }) 
	
	// d3.select("#cebutton").on("change", function(d){
	// 	selectedCE = this.value
	// 	var x = Math.random();
	// 	if (x<0.2){
	// 		document.getElementById("charging-icon").src = "icons/in-use.png";
	// 	}
	// 	else{
	// 		document.getElementById("charging-icon").src = "icons/free.png";	
	// 	}
	}) 
</script>


</body>
</html>